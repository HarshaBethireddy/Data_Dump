<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ report_data.title }} - API Test Framework Report</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .header .subtitle {
            text-align: center;
            color: #7f8c8d;
            font-size: 1.2em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 1.1em;
        }
        
        .success { color: #27ae60; }
        .error { color: #e74c3c; }
        .warning { color: #f39c12; }
        .info { color: #3498db; }
        
        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .chart-container {
            margin: 20px 0;
            min-height: 400px;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #ecf0f1;
        }
        
        th {
            background: #34495e;
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .status-badge {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status-warning {
            background: #fff3cd;
            color: #856404;
        }
        
        .comparison-details {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }
        
        .diff-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #e74c3c;
        }
        
        .diff-path {
            font-family: 'Courier New', monospace;
            background: #ecf0f1;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9em;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9em;
        }
        
        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .metric-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .metric-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>{{ report_data.title }}</h1>
            <div class="subtitle">
                Generated on {{ report_data.generation_timestamp.strftime('%B %d, %Y at %I:%M %p') }}
                | Execution ID: {{ report_data.execution_id }}
            </div>
        </div>

        <!-- Statistics Overview -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value success">{{ report_data.summary.total_requests }}</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value success">{{ report_data.summary.successful_requests }}</div>
                <div class="stat-label">Successful</div>
            </div>
            <div class="stat-card">
                <div class="stat-value error">{{ report_data.summary.failed_requests }}</div>
                <div class="stat-label">Failed</div>
            </div>
            <div class="stat-card">
                <div class="stat-value info">{{ "%.2f"|format(report_data.summary.success_rate * 100) }}%</div>
                <div class="stat-label">Success Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value warning">{{ "%.2f"|format(report_data.summary.average_response_time) }}s</div>
                <div class="stat-label">Avg Response Time</div>
            </div>
            <div class="stat-card">
                <div class="stat-value info">{{ report_data.summary.total_comparisons }}</div>
                <div class="stat-label">Comparisons</div>
            </div>
        </div>

        <!-- Performance Charts -->
        <div class="section">
            <h2>üìä Performance Analytics</h2>
            <div class="chart-container" id="responseTimeChart"></div>
            <div class="chart-container" id="statusCodeChart"></div>
        </div>

        <!-- Test Results -->
        <div class="section">
            <h2>üß™ Test Results</h2>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Request ID</th>
                            <th>Status</th>
                            <th>Response Time</th>
                            <th>Status Code</th>
                            <th>Timestamp</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for response in report_data.responses %}
                        <tr>
                            <td>{{ response.request_id }}</td>
                            <td>
                                <span class="status-badge {% if response.success %}status-success{% else %}status-error{% endif %}">
                                    {% if response.success %}Success{% else %}Failed{% endif %}
                                </span>
                            </td>
                            <td>{{ "%.3f"|format(response.response_time) }}s</td>
                            <td>{{ response.status_code }}</td>
                            <td>{{ response.timestamp.strftime('%H:%M:%S') }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Comparison Results -->
        {% if report_data.comparisons %}
        <div class="section">
            <h2>üîç Comparison Analysis</h2>
            {% for comparison in report_data.comparisons %}
            <div class="comparison-details">
                <h3>{{ comparison.comparison_name }}</h3>
                <div class="performance-metrics">
                    <div class="metric-item">
                        <div class="metric-value {% if comparison.is_identical %}success{% else %}error{% endif %}">
                            {% if comparison.is_identical %}‚úì Identical{% else %}‚úó Different{% endif %}
                        </div>
                        <div class="metric-label">Status</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">{{ "%.1f"|format(comparison.similarity_score * 100) }}%</div>
                        <div class="metric-label">Similarity</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-value">{{ comparison.total_differences }}</div>
                        <div class="metric-label">Differences</div>
                    </div>
                </div>
                
                {% if comparison.differences %}
                <h4>Differences Found:</h4>
                {% for diff in comparison.differences[:10] %}
                <div class="diff-item">
                    <strong>{{ diff.change_type.replace('_', ' ').title() }}</strong>
                    <div class="diff-path">{{ diff.path }}</div>
                    <div>{{ diff.description }}</div>
                    {% if diff.old_value %}
                    <div><strong>Old:</strong> {{ diff.old_value }}</div>
                    {% endif %}
                    {% if diff.new_value %}
                    <div><strong>New:</strong> {{ diff.new_value }}</div>
                    {% endif %}
                </div>
                {% endfor %}
                {% if comparison.differences|length > 10 %}
                <div class="diff-item">
                    <em>... and {{ comparison.differences|length - 10 }} more differences</em>
                </div>
                {% endif %}
                {% endif %}
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Performance Metrics -->
        <div class="section">
            <h2>‚ö° Performance Metrics</h2>
            <div class="performance-metrics">
                <div class="metric-item">
                    <div class="metric-value">{{ "%.3f"|format(report_data.performance_metrics.min_response_time) }}s</div>
                    <div class="metric-label">Min Response Time</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.3f"|format(report_data.performance_metrics.max_response_time) }}s</div>
                    <div class="metric-label">Max Response Time</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.3f"|format(report_data.performance_metrics.p95_response_time) }}s</div>
                    <div class="metric-label">95th Percentile</div>
                </div>
                <div class="metric-item">
                    <div class="metric-value">{{ "%.2f"|format(report_data.performance_metrics.requests_per_second) }}</div>
                    <div class="metric-label">Requests/Second</div>
                </div>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>Generated by API Test Framework v2.0 | 
           Execution Time: {{ "%.2f"|format(report_data.execution_duration) }}s |
           {{ report_data.responses|length }} total responses processed
        </p>
    </div>

    <script>
        // Response Time Chart
        const responseTimeData = [
            {
                x: [{% for response in report_data.responses %}'{{ response.timestamp.strftime('%H:%M:%S') }}'{% if not loop.last %},{% endif %}{% endfor %}],
                y: [{% for response in report_data.responses %}{{ response.response_time }}{% if not loop.last %},{% endif %}{% endfor %}],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Response Time',
                line: { color: '#3498db', width: 3 },
                marker: { size: 6, color: '#2980b9' }
            }
        ];

        const responseTimeLayout = {
            title: {
                text: 'Response Time Over Time',
                font: { size: 18, color: '#2c3e50' }
            },
            xaxis: { 
                title: 'Time',
                gridcolor: '#ecf0f1'
            },
            yaxis: { 
                title: 'Response Time (seconds)',
                gridcolor: '#ecf0f1'
            },
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)',
            font: { family: 'Segoe UI, sans-serif' }
        };

        Plotly.newPlot('responseTimeChart', responseTimeData, responseTimeLayout, {responsive: true});

        // Status Code Distribution Chart
        const statusCodes = {};
        {% for response in report_data.responses %}
        statusCodes['{{ response.status_code }}'] = (statusCodes['{{ response.status_code }}'] || 0) + 1;
        {% endfor %}

        const statusCodeData = [{
            labels: Object.keys(statusCodes),
            values: Object.values(statusCodes),
            type: 'pie',
            hole: 0.4,
            marker: {
                colors: ['#27ae60', '#e74c3c', '#f39c12', '#3498db', '#9b59b6']
            }
        }];

        const statusCodeLayout = {
            title: {
                text: 'Status Code Distribution',
                font: { size: 18, color: '#2c3e50' }
            },
            plot_bgcolor: 'rgba(0,0,0,0)',
            paper_bgcolor: 'rgba(0,0,0,0)',
            font: { family: 'Segoe UI, sans-serif' }
        };

        Plotly.newPlot('statusCodeChart', statusCodeData, statusCodeLayout, {responsive: true});
    </script>
</body>
</html>